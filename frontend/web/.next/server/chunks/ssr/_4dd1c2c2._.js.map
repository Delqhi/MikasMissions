{"version":3,"sources":["turbopack:///[project]/app/admin/runs/page.module.css [app-rsc] (css module)","../../../../app/admin/runs/page.tsx","../../../../.next-internal/server/app/admin/runs/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["__turbopack_context__.v({\n  \"actions\": \"page-module__k-1wGq__actions\",\n  \"empty\": \"page-module__k-1wGq__empty\",\n  \"logList\": \"page-module__k-1wGq__logList\",\n  \"logMeta\": \"page-module__k-1wGq__logMeta\",\n  \"metaCard\": \"page-module__k-1wGq__metaCard\",\n  \"notice\": \"page-module__k-1wGq__notice\",\n  \"panel\": \"page-module__k-1wGq__panel\",\n  \"statusPill\": \"page-module__k-1wGq__statusPill\",\n  \"summary\": \"page-module__k-1wGq__summary\",\n});\n","import { cookies } from \"next/headers\";\nimport { redirect } from \"next/navigation\";\n\nimport { AdminShell } from \"../../../components/layout/admin_shell\";\nimport { apiBaseURL, safeJSONFetch } from \"../../../lib/fetch_helpers\";\nimport styles from \"./page.module.css\";\n\ntype RunResponse = {\n  run_id: string;\n  workflow_id: string;\n  status: string;\n  priority: string;\n  auto_publish: boolean;\n  input_payload: Record<string, unknown>;\n  last_error: string;\n};\n\ntype RunLogsResponse = {\n  run_id: string;\n  logs: Array<{\n    run_id: string;\n    step: string;\n    status: string;\n    message: string;\n    event_time: string;\n  }>;\n};\n\ntype RunsPageProps = {\n  searchParams: Promise<Record<string, string | string[] | undefined>>;\n};\n\nasync function tokenFromCookie(): Promise<string> {\n  const cookieStore = await cookies();\n  return cookieStore.get(\"mm_admin_access_token\")?.value ?? \"\";\n}\n\nasync function retryRun(formData: FormData) {\n  \"use server\";\n  const token = await tokenFromCookie();\n  if (token === \"\") {\n    redirect(\"/admin/login\");\n  }\n  const runID = String(formData.get(\"run_id\") ?? \"\");\n  await safeJSONFetch(new URL(`/v1/admin/runs/${encodeURIComponent(runID)}/retry`, apiBaseURL()).toString(), {\n    method: \"POST\",\n    token\n  });\n  redirect(`/admin/runs?run_id=${encodeURIComponent(runID)}`);\n}\n\nasync function cancelRun(formData: FormData) {\n  \"use server\";\n  const token = await tokenFromCookie();\n  if (token === \"\") {\n    redirect(\"/admin/login\");\n  }\n  const runID = String(formData.get(\"run_id\") ?? \"\");\n  await safeJSONFetch(new URL(`/v1/admin/runs/${encodeURIComponent(runID)}/cancel`, apiBaseURL()).toString(), {\n    method: \"POST\",\n    token\n  });\n  redirect(`/admin/runs?run_id=${encodeURIComponent(runID)}`);\n}\n\nexport const dynamic = \"force-dynamic\";\n\nexport default async function AdminRunsPage({ searchParams }: RunsPageProps) {\n  const token = await tokenFromCookie();\n  if (token === \"\") {\n    return (\n      <AdminShell\n        activeNav=\"Runs\"\n        subtitle=\"Authenticate to inspect execution logs and run controls.\"\n        title=\"Run operations\"\n      >\n        <section className={styles.notice}>\n          <h2>Admin session missing</h2>\n          <a href=\"/admin/login\">Open admin login</a>\n        </section>\n      </AdminShell>\n    );\n  }\n\n  const params = await searchParams;\n  const runID = typeof params.run_id === \"string\" ? params.run_id : \"\";\n  if (runID === \"\") {\n    return (\n      <AdminShell\n        activeNav=\"Runs\"\n        subtitle=\"Select a run id from Studio to inspect status and step logs.\"\n        title=\"Run operations\"\n      >\n        <section className={styles.notice}>\n          <h2>No run selected</h2>\n          <a href=\"/admin/studio\">Back to studio</a>\n        </section>\n      </AdminShell>\n    );\n  }\n\n  const [run, logs] = await Promise.all([\n    safeJSONFetch<RunResponse>(new URL(`/v1/admin/runs/${encodeURIComponent(runID)}`, apiBaseURL()).toString(), { token }),\n    safeJSONFetch<RunLogsResponse>(new URL(`/v1/admin/runs/${encodeURIComponent(runID)}/logs`, apiBaseURL()).toString(), {\n      token\n    })\n  ]);\n\n  return (\n    <AdminShell\n      activeNav=\"Runs\"\n      subtitle=\"Inspect each step, retry failures, or cancel active jobs with full status context.\"\n      title={`Run ${run.run_id}`}\n    >\n      <section className={styles.summary}>\n        <article className={styles.metaCard}>\n          <span>Status</span>\n          <strong className={styles.statusPill} data-status={run.status.toLowerCase()}>\n            {run.status}\n          </strong>\n        </article>\n\n        <article className={styles.metaCard}>\n          <span>Workflow</span>\n          <strong>{run.workflow_id}</strong>\n        </article>\n\n        <article className={styles.metaCard}>\n          <span>Priority</span>\n          <strong>{run.priority}</strong>\n        </article>\n      </section>\n\n      <section className={styles.panel}>\n        <h2>Run controls</h2>\n        <p>Last error: {run.last_error || \"none\"}</p>\n        <div className={styles.actions}>\n          <form action={retryRun}>\n            <input name=\"run_id\" type=\"hidden\" value={run.run_id} />\n            <button type=\"submit\">Retry run</button>\n          </form>\n          <form action={cancelRun}>\n            <input name=\"run_id\" type=\"hidden\" value={run.run_id} />\n            <button type=\"submit\">Cancel run</button>\n          </form>\n          <a href=\"/admin/studio\">Back to studio</a>\n        </div>\n      </section>\n\n      <section className={styles.panel}>\n        <h2>Run logs</h2>\n        <ul className={styles.logList}>\n          {logs.logs.length === 0 ? (\n            <li className={styles.empty}>No logs available for this run yet.</li>\n          ) : (\n            logs.logs.map((entry, index) => (\n              <li key={`${entry.event_time}-${index}`}>\n                <div className={styles.logMeta}>\n                  <span>{entry.event_time}</span>\n                  <strong>{entry.step}</strong>\n                  <em data-status={entry.status.toLowerCase()}>{entry.status}</em>\n                </div>\n                <p>{entry.message}</p>\n              </li>\n            ))\n          )}\n        </ul>\n      </section>\n    </AdminShell>\n  );\n}\n","export {$$RSC_SERVER_ACTION_0 as '40484dc189850c8d1d47c913ed86cf17cbc69898f5'} from 'ACTIONS_MODULE0'\nexport {$$RSC_SERVER_ACTION_1 as '4068e1056cb3228bd9c72ed894a0af88bdb115eff4'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":"yBAAA,EAAA,CAAA,CAAA,CACA,QAAA,+BACA,MAAA,6BACA,QAAA,+BACA,QAAA,+BACA,SAAA,gCACA,OAAA,8BACA,MAAA,6BACA,WAAA,kCACA,QAAA,8BACA,wDCVA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MA2BA,eAAe,IACb,IAAM,EAAc,MAAM,CAAA,EAAA,EAAA,OAAA,AAAO,IACjC,OAAO,EAAY,GAAG,CAAC,0BAA0B,OAAS,EAC5D,KAEA,EAAA,eAAe,AAAS,CAAkB,EAExC,IAAM,EAAQ,MAAM,IACN,IAAI,CAAd,GACF,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAS,gBAEX,IAAM,EAAQ,OAAO,EAAS,GAAG,CAAC,WAAa,GAC/C,OAAM,CAAA,EAAA,EAAA,aAAa,AAAb,EAAc,IAAI,IAAI,CAAC,eAAe,EAAE,mBAAmB,GAAO,MAAM,CAAC,CAAE,CAAA,EAAA,EAAA,UAAA,AAAU,KAAI,QAAQ,GAAI,CACzG,OAAQ,aACR,CACF,GACA,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,CAAC,mBAAmB,EAAE,mBAAmB,GAAA,CAAQ,CAC5D,gCAZA,EAAA,6CAAA,UAcA,EAAA,eAAe,AAAU,CAAkB,EAEzC,IAAM,EAAQ,MAAM,IACN,IAAI,CAAd,GACF,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,gBAEX,IAAM,EAAQ,OAAO,EAAS,GAAG,CAAC,WAAa,GAC/C,OAAM,CAAA,EAAA,EAAA,aAAA,AAAa,EAAC,IAAI,IAAI,CAAC,eAAe,EAAE,mBAAmB,GAAO,OAAO,CAAC,CAAE,CAAA,EAAA,EAAA,UAAA,AAAU,KAAI,QAAQ,GAAI,CAC1G,OAAQ,aACR,CACF,GACA,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,CAAC,mBAAmB,EAAE,mBAAmB,GAAA,CAAQ,CAC5D,EAIe,eAAe,EAAc,cAAE,CAAY,CAAiB,EACzE,IAAM,EAAQ,MAAM,IACpB,GAAc,IAAI,CAAd,EACF,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CACT,UAAU,OACV,SAAS,2DACT,MAAM,0BAEN,CAAA,EAAA,EAAA,IAAA,EAAC,UAAA,CAAQ,UAAW,EAAA,OAAM,CAAC,MAAM,WAC/B,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,UAAG,0BACJ,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,KAAK,wBAAe,0BAM/B,IAAM,EAAS,MAAM,EACf,EAAiC,UAAzB,OAAO,EAAO,MAAM,CAAgB,EAAO,MAAM,CAAG,GAClE,GAAc,IAAI,CAAd,EACF,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CACT,UAAU,OACV,SAAS,+DACT,MAAM,0BAEN,CAAA,EAAA,EAAA,IAAA,EAAC,UAAA,CAAQ,UAAW,EAAA,OAAM,CAAC,MAAM,WAC/B,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,UAAG,oBACJ,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,KAAK,yBAAgB,wBAMhC,GAAM,CAAC,EAAK,EAAK,CAAG,MAAM,QAAQ,GAAG,CAAC,CACpC,CAAA,EAAA,EAAA,aAAA,AAAa,EAAc,IAAI,IAAI,CAAC,eAAe,EAAE,mBAAmB,GAAA,CAAQ,CAAE,CAAA,EAAA,EAAA,UAAA,AAAU,KAAI,QAAQ,GAAI,OAAE,CAAM,GACpH,CAAA,EAAA,EAAA,aAAA,AAAa,EAAkB,IAAI,IAAI,CAAC,eAAe,EAAE,mBAAmB,GAAO,KAAK,CAAC,CAAE,CAAA,EAAA,EAAA,UAAA,AAAU,KAAI,QAAQ,GAAI,OACnH,CACF,GACD,EAED,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,UAAU,CAAA,CACT,UAAU,OACV,SAAS,qFACT,MAAO,CAAC,IAAI,EAAE,EAAI,MAAM,CAAA,CAAE,WAE1B,CAAA,EAAA,EAAA,IAAA,EAAC,UAAA,CAAQ,UAAW,EAAA,OAAM,CAAC,OAAO,WAChC,CAAA,EAAA,EAAA,IAAA,EAAC,UAAA,CAAQ,UAAW,EAAA,OAAM,CAAC,QAAQ,WACjC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAK,WACN,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,UAAW,EAAA,OAAM,CAAC,UAAU,CAAE,cAAa,EAAI,MAAM,CAAC,WAAW,YACtE,EAAI,MAAM,MAIf,CAAA,EAAA,EAAA,IAAA,EAAC,UAAA,CAAQ,UAAW,EAAA,OAAM,CAAC,QAAQ,WACjC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAK,aACN,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAQ,EAAI,WAAW,MAG1B,CAAA,EAAA,EAAA,IAAA,EAAC,UAAA,CAAQ,UAAW,EAAA,OAAM,CAAC,QAAQ,WACjC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAK,aACN,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAQ,EAAI,QAAQ,SAIzB,CAAA,EAAA,EAAA,IAAA,EAAC,UAAA,CAAQ,UAAW,EAAA,OAAM,CAAC,KAAK,WAC9B,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,UAAG,iBACJ,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,WAAE,eAAa,EAAI,UAAU,EAAI,UAClC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAW,EAAA,OAAM,CAAC,OAAO,WAC5B,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,OApGhB,CAoGwB,WACZ,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,KAAK,SAAS,KAAK,SAAS,MAAO,EAAI,MAAM,GACpD,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,KAAK,kBAAS,iBAExB,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,OA1FhB,CA0FwB,WACZ,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,KAAK,SAAS,KAAK,SAAS,MAAO,EAAI,MAAM,GACpD,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,KAAK,kBAAS,kBAExB,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,KAAK,yBAAgB,yBAI5B,CAAA,EAAA,EAAA,IAAA,EAAC,UAAA,CAAQ,UAAW,EAAA,OAAM,CAAC,KAAK,WAC9B,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,UAAG,aACJ,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAW,EAAA,OAAM,CAAC,OAAO,UAC1B,AAAqB,MAAhB,IAAI,CAAC,MAAM,CACf,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAW,EAAA,OAAM,CAAC,KAAK,UAAE,wCAE7B,EAAK,IAAI,CAAC,GAAG,CAAC,CAAC,EAAO,IACpB,CAAA,EAAA,EAAA,IAAA,EAAC,KAAA,WACC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAW,EAAA,OAAM,CAAC,OAAO,WAC5B,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAM,EAAM,UAAU,GACvB,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAQ,EAAM,IAAI,GACnB,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,cAAa,EAAM,MAAM,CAAC,WAAW,YAAK,EAAM,MAAM,MAE5D,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,UAAG,EAAM,OAAO,KANV,CAAA,EAAG,EAAM,UAAU,CAAC,CAAC,EAAE,EAAA,CAAO,UAcrD,+BAvHA,EAAA,6CAAA,+FAcuB,0CCjEvB,IAAA,EAAA,EAAA,CAAA,CAAA"}